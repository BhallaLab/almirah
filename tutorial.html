<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Writing configs" href="writing-configs/index.html" /><link rel="prev" title="User Guide" href="user-guide.html" />

    <!-- Generated with Sphinx 6.2.1 and Furo 2023.09.10 -->
        <title>Tutorial - almirah 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=369552022d0b975c8e74270ce6eabe0fb7978f24" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f0f0f0;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">almirah 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="_static/logo-light-mode.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="_static/logo-dark-mode.png" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="user-guide.html">User Guide</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Tutorial</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="writing-configs/index.html">Writing configs</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Writing configs</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="writing-configs/specification.html">Specification details</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing-configs/rules.html">Organization rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing-configs/mapping.html">Database mapping</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="adbs/index.html">The ADBS Dataset</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of The ADBS Dataset</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="adbs/tutorial.html">From access to analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="adbs/reference/index.html">Dataset Reference</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="reference/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-of-conduct.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/girishmm/almirah/edit/main/docs/source/tutorial.rst" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this heading">#</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">almirah</span></code> is a tool to organize, query, and summarize data. In this
tutorial we will use <code class="docutils literal notranslate"><span class="pre">almirah</span></code> on a dummy test dataset that represents
imaging data obtained from mice to illustrate some of its usecases. In
case you have not installed <code class="docutils literal notranslate"><span class="pre">almirah</span></code> yet, please go to the
<a class="reference internal" href="user-guide.html#installing"><span class="std std-ref">Installing</span></a> section and follow the instructions.</p>
<p>First, let us obtain the dataset to work on for the tutorial. It comes
along with <code class="docutils literal notranslate"><span class="pre">almirah</span></code> and can be copied to a convenient location using
the <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_tutorial_dataset()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">almirah.utils</span> <span class="kn">import</span> <span class="n">get_tutorial_dataset</span>

<span class="n">get_tutorial_dataset</span><span class="p">(</span><span class="s2">&quot;path/to/store&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The dataset contents can be listed using the <code class="docutils literal notranslate"><span class="pre">tree</span></code> command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>tree<span class="w"> </span><span class="s2">&quot;path/to/store&quot;</span>
</pre></div>
</div>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">.</span>
<span class="go">├── 72</span>
<span class="go">│   ├── DAY01_G72_20180201.npy</span>
<span class="go">│   └── DAY02_G72_20180202.npy</span>
<span class="go">├── DAY01_G171_20180101.npy</span>
<span class="go">├── Day2_171_20180102.npy</span>
<span class="go">└── G433</span>
<span class="go">    ├── DAY_G433_20180301.npy</span>
<span class="go">    └── day02_G433_20180301.npy</span>

<span class="go">3 directories, 6 files</span>
</pre></div>
</div>
<p>The dataset is not formatted and is difficult to navigate as can be
seen from content hierarchy. Let us attempt to change this.</p>
<section id="defining-a-specification">
<h2>Defining a Specification<a class="headerlink" href="#defining-a-specification" title="Permalink to this heading">#</a></h2>
<p>The first step to all things <code class="docutils literal notranslate"><span class="pre">almirah</span></code> can do is defining the
<a class="reference internal" href="writing-configs/specification.html"><span class="doc">Specification details</span></a>. To come up with a
<code class="docutils literal notranslate"><span class="pre">Specification</span></code> for this dataset, let us think about how we would
structure this dataset manually.</p>
<section id="deciding-path-patterns">
<h3>Deciding path patterns<a class="headerlink" href="#deciding-path-patterns" title="Permalink to this heading">#</a></h3>
<p>We would prefer to navigate in the following order from the dataset
root directory, <code class="docutils literal notranslate"><span class="pre">mice</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">day</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">file</span></code>. This is intuitive and
leaves scope for expansion on new data generation. Based on this, the
path relative to the dataset root would look like <cite>mice/day/file</cite>.
Further, the file name should contain the details of mice, day, and
the type of imaging for identification. For example, a nice file name
would be <cite>mice-G433_day-01_imaging-calcium.npy</cite>.</p>
<p>The above decided path can be mentioned in the <code class="docutils literal notranslate"><span class="pre">Specification</span></code>
config under the <code class="docutils literal notranslate"><span class="pre">path_patterns</span></code> key like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">path_patterns</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;mice-{mice}/day-{day}/mice-{mice}_day-{day}_imaging-{imaging}{extension}&quot;</span>
</pre></div>
</div>
<p>Here, contents enclosed in <code class="docutils literal notranslate"><span class="pre">{}</span></code> represent that these are tag
values. A <code class="xref py py-class docutils literal notranslate"><span class="pre">File</span></code> in <code class="docutils literal notranslate"><span class="pre">almirah</span></code> is associated with a bunch of
tags. It is possible to provide more details on tags regarding valid
values, the default value, and if the <code class="xref py py-class docutils literal notranslate"><span class="pre">Tag</span></code> is mandatory.</p>
</section>
<section id="building-paths">
<h3>Building paths<a class="headerlink" href="#building-paths" title="Permalink to this heading">#</a></h3>
<p>Now that we have the basic <a class="reference internal" href="writing-configs/specification.html"><span class="doc">Specification details</span></a>, we
can build valid paths by providing the required tags. Tags are
<cite>key</cite>:<cite>value</cite> pairs that convey an information regarding the file. For
our decided path, the tags we require for path building are <code class="docutils literal notranslate"><span class="pre">mice</span></code>,
<code class="docutils literal notranslate"><span class="pre">day</span></code>, <code class="docutils literal notranslate"><span class="pre">imaging</span></code>, and <code class="docutils literal notranslate"><span class="pre">extension</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">almirah</span> <span class="kn">import</span> <span class="n">Specification</span>

<span class="c1"># Create a Specification object</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">Specification</span><span class="p">(</span><span class="s2">&quot;/path/to/config&quot;</span><span class="p">)</span>

<span class="c1"># Check out paths built based on tags provided</span>
<span class="n">spec</span><span class="o">.</span><span class="n">build_path</span><span class="p">(</span><span class="n">mice</span><span class="o">=</span><span class="s1">&#39;G433&#39;</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="n">imaging</span><span class="o">=</span><span class="s1">&#39;calcium&#39;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;.npy&#39;</span><span class="p">)</span>
<span class="c1"># mice-G433/day-01/mice-G433_day-01_imaging-calcium.npy</span>

<span class="n">spec</span><span class="o">.</span><span class="n">build_path</span><span class="p">(</span><span class="n">mice</span><span class="o">=</span><span class="s1">&#39;G41&#39;</span><span class="p">,</span> <span class="n">imaging</span><span class="o">=</span><span class="s1">&#39;calcium&#39;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="s1">&#39;.npy&#39;</span><span class="p">)</span>
<span class="c1"># Returns None as no valid path be built using only these tags</span>
</pre></div>
</div>
</section>
<section id="extracting-tags-from-path">
<h3>Extracting tags from path<a class="headerlink" href="#extracting-tags-from-path" title="Permalink to this heading">#</a></h3>
<p>Certain times, we might need to extract tags from a path. For example,
what is the <code class="docutils literal notranslate"><span class="pre">mice</span></code> tag or the <code class="docutils literal notranslate"><span class="pre">day</span></code> tag given the path? These can
be provided as a sequence of <em>name</em>:<em>regex pattern</em> pairs under the
<code class="docutils literal notranslate"><span class="pre">tags</span></code> key like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tags</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">mice</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="s2">&quot;[/</span><span class="se">\\\\</span><span class="s2">]mice-([a-zA-Z0-9]+)&quot;</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">day</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="s2">&quot;[/</span><span class="se">\\\\</span><span class="s2">]+day-([0-9]+)&quot;</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">imaging</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="s2">&quot;[_/</span><span class="se">\\\\</span><span class="s2">]+imaging-([a-zA-Z]+)&quot;</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">extension</span>
    <span class="n">pattern</span><span class="p">:</span> <span class="s2">&quot;[^./</span><span class="se">\\\\</span><span class="s2">](</span><span class="se">\\</span><span class="s2">.[^/</span><span class="se">\\\\</span><span class="s2">]+)$&quot;</span>
</pre></div>
</div>
<p>The capturing group in the regex pattern extracts the tag value from
the path.</p>
<p>Putting all of these together, we have our <code class="docutils literal notranslate"><span class="pre">Specification</span></code> config:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tags</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mice</span>
<span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;[/\\\\]mice-([a-zA-Z0-9]+)&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">day</span>
<span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;[/\\\\]+day-([0-9]+)&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">imaging</span>
<span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;[_/\\\\]+imaging-([a-zA-Z]+)&quot;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extension</span>
<span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;[^./\\\\](\\.[^/\\\\]+)$&quot;</span>
<span class="nt">path_patterns</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;mice-{mice}/day-{day}/mice-{mice}_day-{day}_imaging-{imaging}{extension}&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="organizing-the-dataset">
<h2>Organizing the dataset<a class="headerlink" href="#organizing-the-dataset" title="Permalink to this heading">#</a></h2>
<p>With the <code class="xref py py-class docutils literal notranslate"><span class="pre">Specification</span></code> defined, it is now possible to
restructure a dataset given that we are able to retrieve the tags
required to build a valid path from each target file. If we are able
to build a valid relative path, then it just boils down to just moving
the file to that position with respect to the root directory. Lets us
do this for our dataset.</p>
<p>Required parameters to begin organizing a dataset are:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code>: The root directory of unorganized data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">destination</span></code>: The directory where organized data will be stored.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code>: All filenames matching this pattern are considered for
organizing. For our dataset, this can be <code class="docutils literal notranslate"><span class="pre">*.npy</span></code>.</p></li>
</ol>
<section id="establishing-tag-rules">
<h3>Establishing tag rules<a class="headerlink" href="#establishing-tag-rules" title="Permalink to this heading">#</a></h3>
<p>Let us consider all the file names in the dataset, namely:</p>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">DAY01_G72_20180201.npy</span>
<span class="go">DAY02_G72_20180202.npy</span>
<span class="go">DAY01_G171_20180101.npy</span>
<span class="go">Day2_171_20180102.npy</span>
<span class="go">DAY_G433_20180301.npy</span>
<span class="go">day02_G433_20180301.npy</span>
</pre></div>
</div>
<p>We notice that the <code class="docutils literal notranslate"><span class="pre">day</span></code> tag value is at the beginning between the
string <cite>day</cite> (ignoring case) and an <cite>_</cite> (underscore). This can be
extracted with the regex pattern <code class="docutils literal notranslate"><span class="pre">(?i)day([0-9]+)_</span></code>. But one of the
files does not have any info on the day value and for this no value
will be captured. Since we have exclusive information from the person
who performed the experiments, we know it is <code class="docutils literal notranslate"><span class="pre">1</span></code> and by default if
no value is captured we would like to choose this. Further, to
maintain uniformity we would like to ensure that the length of <code class="docutils literal notranslate"><span class="pre">day</span></code>
tag is <code class="docutils literal notranslate"><span class="pre">2</span></code>, and if not prefix it with <code class="docutils literal notranslate"><span class="pre">0</span></code>. Putting these together
as a tag retrieval rule:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tags_rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">day</span>
<span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;(?i)day([0-9]+)_&quot;</span>
<span class="w">    </span><span class="nt">length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">iffy_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div>
</div>
<p>Similarly, we see that the value following the first underscore gives
the <code class="docutils literal notranslate"><span class="pre">mice</span></code> info. This can be extracted with the regex pattern
<code class="docutils literal notranslate"><span class="pre">_([a-zA-Z0-9]+)_</span></code>. Since one of the files does not have the
<code class="docutils literal notranslate"><span class="pre">mice</span></code> info beginning with the suffix <em>G</em>, we choose to extract only
the numbers with the regex pattern using <code class="docutils literal notranslate"><span class="pre">_G?([0-9]+)_</span></code> and prepend
it with <em>G</em>. Putting these together as a rule:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tags_rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mice</span>
<span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;_G?([0-9]+)_&quot;</span>
<span class="w">    </span><span class="nt">prepend</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">G</span>
</pre></div>
</div>
<p>There is no value for the <code class="docutils literal notranslate"><span class="pre">imaging</span></code> tag in path but we know that it
is <em>calcium</em> imaging data, so let us set all values to <em>calcium</em>. And
similarly, let <code class="docutils literal notranslate"><span class="pre">extension</span></code> be <em>.npy</em>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">tags_rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">imaging</span>
<span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">calcium</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extension</span>
<span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npy</span>
</pre></div>
</div>
<p>Putting these together, we get our organization rules config:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/unorganized/data&quot;</span>
<span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/store/organized/data&quot;</span>
<span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;*.npy&quot;</span>
<span class="nt">tags_rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">day</span>
<span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;(?i)day([0-9]+)_&quot;</span>
<span class="w">    </span><span class="nt">length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">iffy_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mice</span>
<span class="w">    </span><span class="nt">pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;_G?([0-9]+)_&quot;</span>
<span class="w">    </span><span class="nt">prepend</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">G</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">imaging</span>
<span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">calcium</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extension</span>
<span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npy</span>
</pre></div>
</div>
</section>
<section id="executing-the-rules">
<h3>Executing the rules<a class="headerlink" href="#executing-the-rules" title="Permalink to this heading">#</a></h3>
<p>To run this set of rules and obtain the organized dataset, we can use
<code class="xref py py-meth docutils literal notranslate"><span class="pre">organize()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">read_yaml</span>

<span class="c1"># Load rules into dictionary</span>
<span class="n">rules</span> <span class="o">=</span> <span class="n">read_yaml</span><span class="p">(</span><span class="s2">&quot;/path/to/rules&quot;</span><span class="p">)</span>

<span class="c1"># Execute rules and use Specification for path building</span>
<span class="n">spec</span><span class="o">.</span><span class="n">organize</span><span class="p">(</span><span class="n">rules</span><span class="p">)</span>
</pre></div>
</div>
<p>Listing the contents of the organized dataset using <code class="docutils literal notranslate"><span class="pre">tree</span></code> after the
run gives:</p>
<div class="highlight-output notranslate"><div class="highlight"><pre><span></span><span class="go">.</span>
<span class="go">├── mice-G72</span>
<span class="go">│   ├── day-01</span>
<span class="go">│   │   └── mice-G72_day-01_imaging-calcium.npy</span>
<span class="go">│   └── day-02</span>
<span class="go">│       └── mice-G72_day-02_imaging-calcium.npy</span>
<span class="go">├── mice-G171</span>
<span class="go">│   ├── day-01</span>
<span class="go">│   │   └── mice-G171_day-01_imaging-calcium.npy</span>
<span class="go">│   └── day-02</span>
<span class="go">│       └── mice-G171_day-02_imaging-calcium.npy</span>
<span class="go">└── mice-G433</span>
<span class="go">    ├── day-01</span>
<span class="go">    │   └── mice-G433_day-01_imaging-calcium.npy</span>
<span class="go">    └── day-02</span>
<span class="go">        └── mice-G433_day-02_imaging-calcium.npy</span>
</pre></div>
</div>
<p>This is much easier to navigate and structured. Along with this comes
the bonus of being able to query the dataset once indexed. In
<code class="docutils literal notranslate"><span class="pre">almirah</span></code>, a collection of files with a common root directory form a
<code class="xref py py-class docutils literal notranslate"><span class="pre">Layout</span></code> and a collection of layouts form a <code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code>.</p>
</section>
</section>
<section id="querying">
<h2>Querying<a class="headerlink" href="#querying" title="Permalink to this heading">#</a></h2>
<p>Tags associated with files can help in filtering through the
dataset. We can retrieve a subset of files that satisfy certain
tags. An operation called indexing makes this possible.</p>
<section id="the-indexing-operation">
<h3>The indexing operation<a class="headerlink" href="#the-indexing-operation" title="Permalink to this heading">#</a></h3>
<p>In brief, the indexing operation on a <code class="xref py py-class docutils literal notranslate"><span class="pre">Layout</span></code> or a
<code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code> crawls top-down from the root directory and figures
out the <em>tag</em>:<em>file</em> associations. These associations are stored and
used while querying to filter through the dataset. Additional
associations for a file excluding tags present in the path can be
provided with an accompanying <em>JSON</em> file that shares the same
filename. Indexing is performed automatically on creation of a
<code class="xref py py-class docutils literal notranslate"><span class="pre">Layout</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code>.</p>
<p>To index our tutorial dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">almirah</span> <span class="kn">import</span> <span class="n">Layout</span>

<span class="c1"># Create a Layout instance with data path and Specification</span>
<span class="n">layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;/path/to/organized/data&quot;</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="n">spec</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">layout</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
<span class="c1"># /path/to/organized/data</span>
</pre></div>
</div>
<p>The returned instance has all details including the files in it and
tags for each file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Files in layout: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">layout</span><span class="o">.</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Files in layout: 6</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The first file is </span><span class="si">{</span><span class="n">layout</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="c1"># The first file is &lt;File path=`/path/to/file`&gt;.</span>
</pre></div>
</div>
<p>With this, we can start querying in multiple ways.</p>
</section>
<section id="filtering-with-tags">
<h3>Filtering with tags<a class="headerlink" href="#filtering-with-tags" title="Permalink to this heading">#</a></h3>
<p>An instance associated with the indexer can be queried with
<code class="xref py py-meth docutils literal notranslate"><span class="pre">get_files()</span></code> using tag values. For example, retrieve
all files of mice <em>G171</em> where recording was done on day <em>02</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">layout</span><span class="o">.</span><span class="n">get_files</span><span class="p">(</span><span class="n">mice</span><span class="o">=</span><span class="s1">&#39;G171&#39;</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="s1">&#39;02&#39;</span><span class="p">)</span>
<span class="c1"># [&#39;/root/mice-G171_day-01_imaging-calcium.npy&#39;,</span>
<span class="c1">#  &#39;/root/mice-G171_day-02_imaging-calcium.npy&#39;]</span>
</pre></div>
</div>
<p>A list of <code class="xref py py-class docutils literal notranslate"><span class="pre">File</span></code> objects is returned. These can be utilised for
further downstream analysis pipelines.</p>
</section>
</section>
<section id="other-capabilities">
<h2>Other capabilities<a class="headerlink" href="#other-capabilities" title="Permalink to this heading">#</a></h2>
<p>This tutorial is a quick run-through some of the things <code class="docutils literal notranslate"><span class="pre">almirah</span></code> can help with. There are other things it can do:</p>
<ul class="simple">
<li><p>Migrate database records from one schema to another</p></li>
<li><p>Interface with DataLad compatible datasets</p></li>
</ul>
<p>The <a class="reference internal" href="reference/index.html"><span class="doc">API Reference</span></a> acts as good starting point if you need these.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="writing-configs/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Writing configs</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="user-guide.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">User Guide</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, girish
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/girishmm/almirah/" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#defining-a-specification">Defining a Specification</a><ul>
<li><a class="reference internal" href="#deciding-path-patterns">Deciding path patterns</a></li>
<li><a class="reference internal" href="#building-paths">Building paths</a></li>
<li><a class="reference internal" href="#extracting-tags-from-path">Extracting tags from path</a></li>
</ul>
</li>
<li><a class="reference internal" href="#organizing-the-dataset">Organizing the dataset</a><ul>
<li><a class="reference internal" href="#establishing-tag-rules">Establishing tag rules</a></li>
<li><a class="reference internal" href="#executing-the-rules">Executing the rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#querying">Querying</a><ul>
<li><a class="reference internal" href="#the-indexing-operation">The indexing operation</a></li>
<li><a class="reference internal" href="#filtering-with-tags">Filtering with tags</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-capabilities">Other capabilities</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    </body>
</html>